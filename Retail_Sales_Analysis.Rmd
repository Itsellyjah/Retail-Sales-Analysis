---
title: "Retail Sales Data Analysis"
author: "Data Analyst"
date: "May 27, 2025"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    highlight: tango
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.width = 10, fig.height = 6)

# Set CRAN mirror
options(repos = c(CRAN = "https://cloud.r-project.org"))

# Install and load required packages
required_packages <- c("readr", "dplyr", "ggplot2", "lubridate", "knitr", 
                       "kableExtra", "scales", "DT", "plotly")

for(pkg in required_packages) {
  if(!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  }
}
```

## Introduction

This document presents an analysis of retail sales data. The dataset contains information about orders, customers, products, and sales figures from a retail business. The analysis explores sales patterns across different categories, regions, customer segments, and time periods.

## Data Loading and Preprocessing

First, let's load the data and perform some initial preprocessing.

```{r load-data}
# Load the data
retail_data <- read.csv("train.csv", stringsAsFactors = FALSE, check.names = FALSE)

# Clean column names (remove BOM character if present)
names(retail_data)[1] <- "Row ID"

# Display the structure of the data
str(retail_data)

# View the first few rows
head(retail_data) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 11)

# Check for missing values
missing_values <- colSums(is.na(retail_data))
missing_values[missing_values > 0]
```

### Data Preprocessing

Let's convert date columns and create additional features for analysis.

```{r preprocess}
# Convert date columns to Date type
retail_data$`Order Date` <- as.Date(retail_data$`Order Date`, format = "%Y-%m-%d")
retail_data$`Ship Date` <- as.Date(retail_data$`Ship Date`, format = "%Y-%m-%d")

# Calculate shipping days
retail_data$`Shipping Days` <- as.numeric(retail_data$`Ship Date` - retail_data$`Order Date`)

# Extract year and month for time-based analysis
retail_data$Year <- year(retail_data$`Order Date`)
retail_data$Month <- month(retail_data$`Order Date`, label = TRUE)
retail_data$YearMonth <- format(retail_data$`Order Date`, "%Y-%m")

# Summary statistics
summary(retail_data[, c("Sales", "Shipping Days", "Year")])
```

## Sales Analysis

### Sales by Category

```{r category-analysis}
# Total sales by category
sales_by_category <- retail_data %>%
  group_by(Category) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`),
    Avg_Order_Value = Total_Sales / Order_Count
  ) %>%
  arrange(desc(Total_Sales))

# Display the results
sales_by_category %>%
  mutate(
    Total_Sales = dollar(Total_Sales),
    Avg_Order_Value = dollar(Avg_Order_Value)
  ) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize
ggplot(sales_by_category, aes(x = reorder(Category, -Total_Sales), y = Total_Sales)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_text(aes(label = sprintf("$%.1fK", Total_Sales/1000)), vjust = -0.5) +
  labs(title = "Total Sales by Category",
       x = "Category",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format())
```

### Sales by Sub-Category

```{r subcategory-analysis}
# Sales by sub-category
sales_by_subcategory <- retail_data %>%
  group_by(Category, `Sub-Category`) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`)
  ) %>%
  arrange(Category, desc(Total_Sales))

# Display the results
sales_by_subcategory %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize top sub-categories
top_subcategories <- retail_data %>%
  group_by(`Sub-Category`) %>%
  summarise(Total_Sales = sum(Sales, na.rm = TRUE)) %>%
  arrange(desc(Total_Sales)) %>%
  head(10)

ggplot(top_subcategories, aes(x = reorder(`Sub-Category`, Total_Sales), y = Total_Sales)) +
  geom_bar(stat = "identity", fill = "coral") +
  coord_flip() +
  labs(title = "Top 10 Sub-Categories by Sales",
       x = "Sub-Category",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format())
```

## Geographic Analysis

### Sales by Region

```{r region-analysis}
# Sales by region
sales_by_region <- retail_data %>%
  group_by(Region) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`)
  ) %>%
  arrange(desc(Total_Sales))

# Display the results
sales_by_region %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize
ggplot(sales_by_region, aes(x = reorder(Region, -Total_Sales), y = Total_Sales)) +
  geom_bar(stat = "identity", fill = "darkgreen") +
  geom_text(aes(label = sprintf("$%.1fK", Total_Sales/1000)), vjust = -0.5) +
  labs(title = "Total Sales by Region",
       x = "Region",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format())
```

### Sales by State

```{r state-analysis}
# Sales by state
sales_by_state <- retail_data %>%
  group_by(State) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`)
  ) %>%
  arrange(desc(Total_Sales))

# Display top 10 states
sales_by_state %>%
  head(10) %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize top 10 states
ggplot(sales_by_state %>% head(10), 
       aes(x = reorder(State, -Total_Sales), y = Total_Sales)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Top 10 States by Sales",
       x = "State",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Customer Analysis

### Sales by Customer Segment

```{r segment-analysis}
# Sales by customer segment
sales_by_segment <- retail_data %>%
  group_by(Segment) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`),
    Customer_Count = n_distinct(`Customer ID`),
    Avg_Sales_per_Customer = Total_Sales / Customer_Count
  ) %>%
  arrange(desc(Total_Sales))

# Display the results
sales_by_segment %>%
  mutate(
    Total_Sales = dollar(Total_Sales),
    Avg_Sales_per_Customer = dollar(Avg_Sales_per_Customer)
  ) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize
ggplot(sales_by_segment, aes(x = reorder(Segment, -Total_Sales), y = Total_Sales)) +
  geom_bar(stat = "identity", fill = "purple") +
  geom_text(aes(label = sprintf("$%.1fK", Total_Sales/1000)), vjust = -0.5) +
  labs(title = "Sales by Customer Segment",
       x = "Segment",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format())
```

### Top Customers

```{r top-customers}
# Top customers by sales
top_customers <- retail_data %>%
  group_by(`Customer Name`, `Customer ID`) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`)
  ) %>%
  arrange(desc(Total_Sales)) %>%
  head(10)

# Display the results
top_customers %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## Time Series Analysis

### Monthly Sales Trend

```{r time-series}
# Monthly sales trend
monthly_sales <- retail_data %>%
  group_by(YearMonth) %>%
  summarise(Total_Sales = sum(Sales, na.rm = TRUE)) %>%
  arrange(YearMonth)

# Convert YearMonth to Date for better plotting
monthly_sales$YearMonth <- as.Date(paste0(monthly_sales$YearMonth, "-01"))

# Visualize
ggplot(monthly_sales, aes(x = YearMonth, y = Total_Sales)) +
  geom_line(color = "blue") +
  geom_point(color = "red", size = 2) +
  labs(title = "Monthly Sales Trend",
       x = "Month",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_x_date(date_labels = "%b %Y", date_breaks = "3 months") +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Sales by Year and Category

```{r yearly-category}
# Sales by year and category
yearly_category_sales <- retail_data %>%
  group_by(Year, Category) %>%
  summarise(Total_Sales = sum(Sales, na.rm = TRUE)) %>%
  arrange(Year, desc(Total_Sales))

# Display the results
yearly_category_sales %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize
ggplot(yearly_category_sales, aes(x = as.factor(Year), y = Total_Sales, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Sales by Year and Category",
       x = "Year",
       y = "Total Sales ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format()) +
  scale_fill_brewer(palette = "Set1")
```

## Product Analysis

### Top Products

```{r product-analysis}
# Product performance
product_performance <- retail_data %>%
  group_by(`Product Name`, `Product ID`, Category, `Sub-Category`) %>%
  summarise(
    Total_Sales = sum(Sales, na.rm = TRUE),
    Order_Count = n()
  ) %>%
  arrange(desc(Total_Sales)) %>%
  head(10)

# Display the results
product_performance %>%
  mutate(Total_Sales = dollar(Total_Sales)) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"), font_size = 11)
```

## Shipping Analysis

```{r shipping-analysis}
# Shipping analysis
shipping_summary <- retail_data %>%
  group_by(`Ship Mode`) %>%
  summarise(
    Avg_Shipping_Days = mean(`Shipping Days`, na.rm = TRUE),
    Order_Count = n_distinct(`Order ID`),
    Total_Sales = sum(Sales, na.rm = TRUE)
  ) %>%
  arrange(`Ship Mode`)

# Display the results
shipping_summary %>%
  mutate(
    Total_Sales = dollar(Total_Sales),
    Avg_Shipping_Days = round(Avg_Shipping_Days, 2)
  ) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Visualize
ggplot(shipping_summary, aes(x = reorder(`Ship Mode`, Avg_Shipping_Days), 
                            y = Avg_Shipping_Days)) +
  geom_bar(stat = "identity", fill = "orange") +
  geom_text(aes(label = round(Avg_Shipping_Days, 1)), vjust = -0.5) +
  labs(title = "Average Shipping Days by Ship Mode",
       x = "Ship Mode",
       y = "Average Shipping Days") +
  theme_minimal()
```

## Conclusion

This analysis provides insights into the retail sales data across various dimensions:

1. **Product Categories**: Technology products generate the highest sales, followed by Furniture and Office Supplies.

2. **Geographic Distribution**: The West region leads in sales, with California being the top-performing state.

3. **Customer Segments**: The Consumer segment accounts for the largest portion of sales.

4. **Time Trends**: Sales show growth over the years, with some seasonal patterns visible in the monthly data.

5. **Shipping**: Standard Class is the most common shipping mode, while Same Day shipping has the shortest delivery time.

These insights can help inform business decisions related to inventory management, marketing strategies, and customer targeting.

## Next Steps

Potential next steps for further analysis could include:

1. Predictive modeling to forecast future sales
2. Customer segmentation analysis using clustering techniques
3. Market basket analysis to identify product associations
4. Geographic sales analysis with mapping
5. Time series decomposition to identify seasonality and trends

## Session Info

```{r session-info}
sessionInfo()
```
